<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Talent Registry: Strategic Career Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .header-bg { background-color: #ffffff; border-bottom: 1px solid #e5e7eb; }
        .primary-color { color: #1e3a8a; /* Deep Navy */ }
        .primary-bg { background-color: #1e3a8a; }
        .primary-hover:hover { background-color: #1e40af; }
        .accent-bg { background-color: #d1d5db; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; justify-content: center; align-items: center;
            z-index: 60;
            opacity: 0;
            transition: opacity 0.3s ease-out;
            pointer-events: none;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-container {
            background-color: #ffffff;
            color: #1f2937;
            padding: 2.5rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-out;
        }
        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }
        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.85);
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
        }
        .card {
            border: 1px solid #e5e7eb;
            transition: box-shadow 0.2s;
        }
        .card:hover {
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.1);
        }
        .pathway-card {
            border-left: 5px solid #1e3a8a; /* Navy accent */
            min-height: 140px;
        }
        /* Custom status badges for formal look */
        .status-certified { background-color: #d1fae5; color: #065f46; border-color: #34d399; } /* Green */
        .status-submitted { background-color: #eff6ff; color: #1e40af; border-color: #60a5fa; } /* Blue */
        .status-inprogress { background-color: #fef3c7; color: #b45309; border-color: #fcd34d; } /* Orange */
        .status-notstarted { background-color: #f3f4f6; color: #4b5563; border-color: #9ca3af; } /* Gray */

    </style>
</head>
<body class="text-gray-900 leading-normal tracking-wide min-h-screen pb-24">
    
    <!-- Firebase Imports and Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firestore Debug Logging (Mandatory)
        setLogLevel('Debug');

        // Global variables provided by the canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        const API_KEY = ""; // Placeholder for Gemini API Key
        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";
        const GEMINI_IMAGE_MODEL = "imagen-4.0-generate-001"; // Not used here, but good practice to define
        const GEMINI_API_URL_BASE = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`;
        
        let app, db, auth;
        let userId = null;
        let isAuthReady = false;

        // UI Elements
        const loadingOverlay = document.getElementById('loading-overlay');
        const welcomeMessage = document.getElementById('welcome-message');
        const userIdDisplay = document.getElementById('user-id-display');
        const skillInput = document.getElementById('skill-input');
        const skillsList = document.getElementById('skills-list');
        const pathwayContainer = document.getElementById('pathway-container');
        const capstoneStatusBadge = document.getElementById('capstone-status-badge');
        const jobMatchesList = document.getElementById('job-matches-list');
        const profileModal = document.getElementById('profile-modal-overlay');
        const mentorModal = document.getElementById('mentor-modal-overlay');
        const mentorResponse = document.getElementById('mentor-response');
        const pathwayLoading = document.getElementById('pathway-loading');

        // Profile Form Elements
        const fullNameInput = document.getElementById('profile-full-name');
        const emailInput = document.getElementById('profile-email');
        const locationInput = document.getElementById('profile-location');
        const bioInput = document.getElementById('profile-bio');
        const desiredRoleInput = document.getElementById('profile-desired-role');
        const summaryOutput = document.getElementById('summary-output');

        // Initial Data Structure (Defaults)
        let userData = {
            fullName: '', 
            email: '',
            location: 'Gaborone',
            bio: 'A brief professional summary...',
            desiredRole: '',
            skills: [],
            selectedPathway: null,
            capstoneStatus: 'Not Started', // Not Started, In Progress, Submitted, Certified
            jobMatches: [],
            professionalSummary: '', // New field for LLM output
        };

        // --- Utility Functions ---

        const setLoading = (isLoading) => {
            loadingOverlay.style.display = isLoading ? 'flex' : 'none';
        };

        const setPathwayLoading = (isLoading) => {
            pathwayLoading.style.display = isLoading ? 'flex' : 'none';
        };

        const displayMessage = (type, message) => {
            console.log(`[${type.toUpperCase()}] ${message}`);
            // In a real app, this would show a toast/notification
        };
        
        const fetchLLMResponse = async (payload, maxRetries = 3) => {
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(GEMINI_API_URL_BASE, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return candidate.content.parts[0].text;
                    } else {
                        throw new Error("Invalid response structure from Gemini API.");
                    }
                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    if (attempt === maxRetries - 1) {
                        displayMessage('error', 'LLM service failed after multiple retries.');
                        return null;
                    }
                    // Exponential backoff
                    await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                }
            }
        };
        
        // --- Modal Functions ---
        
        window.openProfileModal = () => {
            // Populate form with current data from the live userData object
            fullNameInput.value = userData.fullName || '';
            emailInput.value = userData.email || '';
            locationInput.value = userData.location || 'Gaborone';
            bioInput.value = userData.bio || '';
            desiredRoleInput.value = userData.desiredRole || '';
            summaryOutput.value = userData.professionalSummary || '';
            
            profileModal.classList.add('active');
        };

        window.closeProfileModal = () => {
            profileModal.classList.remove('active');
        };
        
        window.openMentorModal = (message) => {
            mentorResponse.innerHTML = message;
            mentorModal.classList.add('active');
        };
        
        window.closeMentorModal = () => {
            mentorModal.classList.remove('active');
        };

        window.saveProfile = () => {
            // Update local userData object from form values
            userData.fullName = fullNameInput.value.trim();
            userData.email = emailInput.value.trim();
            userData.location = locationInput.value.trim();
            userData.bio = bioInput.value.trim();
            userData.desiredRole = desiredRoleInput.value.trim();
            userData.professionalSummary = summaryOutput.value.trim();

            saveUserData();
            closeProfileModal();
            displayMessage('success', 'Profile record updated successfully.');
        };


        // --- Firebase Core Functions ---

        const initFirebase = async () => {
            if (firebaseConfig) {
                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    
                    await new Promise(resolve => {
                        onAuthStateChanged(auth, async (user) => {
                            if (user) {
                                userId = user.uid;
                                console.log("Authenticated user ID:", userId);
                                resolve();
                            } else {
                                try {
                                    if (initialAuthToken) {
                                        await signInWithCustomToken(auth, initialAuthToken);
                                    } else {
                                        await signInAnonymously(auth);
                                    }
                                } catch (error) {
                                    console.error("Authentication failed:", error);
                                }
                            }
                        });
                    });

                    isAuthReady = true;
                    setLoading(false);
                    setupRealtimeListeners(); 
                    
                } catch (error) {
                    console.error("Error initializing Firebase:", error);
                    displayMessage('error', 'Failed to initialize the platform services.');
                    setLoading(false);
                }
            } else {
                console.warn("Firebase config not available. Running in simulated mode.");
                isAuthReady = true;
                userId = 'simulated-user';
                setLoading(false);
                userData.fullName = 'Simulated Executive';
                userData.skills = ['Financial Modeling', 'Data Analysis', 'Strategic Planning'];
                userData.selectedPathway = { name: 'Chief Investment Officer', relevance: 95, geometry: 'Gaborone (High Priority)', citation: 'Simulated Data' };
                userData.jobMatches = [
                    { title: 'Director of Finance, BPC', location: 'Gaborone', match: 95 }, 
                    { title: 'Head of Strategy, Debswana', location: 'Orapa', match: 88 }
                ];
                userData.professionalSummary = 'Simulated leader with proven track record in financial strategy.';
                updateUI();
            }
        };

        // --- Firestore Data Operations ---

        const getUserDocRef = () => {
            // Private data storage path: /artifacts/{appId}/users/{userId}/userData/profile
            return doc(db, 'artifacts', appId, 'users', userId, 'userData', 'profile');
        };

        const setupRealtimeListeners = () => {
            if (!isAuthReady || !userId) return;

            // Display full user ID for clarity
            userIdDisplay.textContent = `Client ID: ${userId}`;

            // Listen to the user's main profile data
            onSnapshot(getUserDocRef(), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const data = docSnapshot.data();
                    
                    userData = {
                        ...userData, 
                        ...data,
                        skills: data.skills || [], 
                        jobMatches: data.jobMatches || [], 
                    };

                    updateUI();
                } else {
                    saveUserData();
                    updateUI();
                }
            }, (error) => {
                console.error("Error fetching user data:", error);
            });
        };

        const saveUserData = async () => {
            if (!isAuthReady || !userId) return;
            try {
                const dataToSave = {
                    fullName: userData.fullName || '',
                    email: userData.email || '',
                    location: userData.location || 'Gaborone',
                    bio: userData.bio || '',
                    desiredRole: userData.desiredRole || '',
                    skills: userData.skills,
                    selectedPathway: userData.selectedPathway,
                    capstoneStatus: userData.capstoneStatus,
                    jobMatches: userData.jobMatches,
                    professionalSummary: userData.professionalSummary || '', // Save new field
                };
                await setDoc(getUserDocRef(), dataToSave, { merge: true });
            } catch (error) {
                console.error("Error saving user data:", error);
                displayMessage('error', 'Data persistence failed. Review connection status.');
            }
        };


        // --- LLM Powered Features ---

        window.findPathway = () => {
            if (userData.skills.length === 0) {
                displayMessage('warn', 'Define competencies (skills) before executing the market alignment analysis.');
                return;
            }
            if (!userData.desiredRole) {
                 displayMessage('warn', 'Define your Target Executive Role in the Account Management section before running the full analysis.');
                return;
            }
            findPathwayWithLLM();
        };

        const findPathwayWithLLM = async () => {
            setPathwayLoading(true);
            
            const userQuery = `Analyze the following core competencies: ${userData.skills.join(', ')}. The user is currently based in ${userData.location} and is targeting the executive role: ${userData.desiredRole}. Based on current market trends and job postings in Southern Africa, suggest the SINGLE most relevant executive career trajectory, calculate a relevance score (0-100, based on market demand and skill fit), and list two specific skills the user should immediately develop to secure this role.`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }], // Use Google Search for grounding
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "trajectoryName": { "type": "STRING", "description": "The suggested executive job title or pathway." },
                            "relevanceScore": { "type": "INTEGER", "description": "A score from 70 to 100." },
                            "marketGeometry": { "type": "STRING", "description": "A brief, formal statement on regional market demand." },
                            "gapSkills": { "type": "ARRAY", "items": { "type": "STRING" }, "description": "Two key skills needed to close the gap." }
                        },
                        required: ["trajectoryName", "relevanceScore", "marketGeometry", "gapSkills"]
                    }
                }
            };

            const responseText = await fetchLLMResponse(payload);
            setPathwayLoading(false);
            
            if (responseText) {
                try {
                    const result = JSON.parse(responseText);
                    
                    userData.selectedPathway = {
                        name: result.trajectoryName,
                        relevance: result.relevanceScore,
                        geometry: result.marketGeometry,
                        citation: 'Real-time Market Data (LLM)',
                        gapSkills: result.gapSkills,
                    };

                    // Simulate job matches based on the new pathway
                    userData.jobMatches = [
                        { title: result.trajectoryName, location: userData.location, match: result.relevanceScore },
                        { title: `Senior Specialist - ${result.gapSkills[0]}`, location: 'Remote', match: result.relevanceScore - 5 },
                    ];
                    
                    saveUserData();
                    displayMessage('success', 'Strategic market alignment assessment completed successfully.');
                } catch (e) {
                    console.error("Error parsing LLM JSON response:", e);
                    displayMessage('error', 'LLM output error. Try refining your input.');
                }
            }
        };
        
        window.generateSummary = async () => {
            const currentBio = bioInput.value;
            const currentSkills = userData.skills.length > 0 ? userData.skills.join(', ') : 'None listed.';
            const targetRole = desiredRoleInput.value || 'undefined role';

            if (currentSkills === 'None listed.' || !targetRole) {
                displayMessage('warn', 'Please ensure you have defined skills and a target role before generating a summary.');
                return;
            }
            
            summaryOutput.value = 'Generating summary...';

            const systemPrompt = "You are an executive communications specialist. Your task is to generate a highly formal, impactful professional summary and a concise executive headline based on the provided data. The output MUST be a JSON object.";
            const userQuery = `Core Competencies: ${currentSkills}. Target Role: ${targetRole}. Current Bio Draft: ${currentBio}. Generate a high-impact summary (max 35 words) and an executive headline (max 10 words).`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "headline": { "type": "STRING", "description": "A concise, high-impact executive headline." },
                            "summary": { "type": "STRING", "description": "A professional summary (max 35 words)." }
                        }
                    }
                }
            };
            
            const responseText = await fetchLLMResponse(payload);
            
            if (responseText) {
                try {
                    const result = JSON.parse(responseText);
                    summaryOutput.value = `${result.headline} | ${result.summary}`;
                    displayMessage('success', 'Professional Summary generated.');
                } catch (e) {
                    console.error("Error parsing LLM JSON response:", e);
                    summaryOutput.value = 'Generation failed. Check console for error.';
                }
            }
        };
        
        window.engageAIMentor = async () => {
            if (!userData.selectedPathway) {
                openMentorModal('<p class="text-lg font-semibold text-gray-800">Prerequisite Required</p><p class="mt-2 text-gray-600">Please first execute the Strategic Market Alignment analysis to define your optimal career pathway before engaging the AI Mentor.</p>');
                return;
            }

            mentorResponse.innerHTML = '<div class="flex items-center space-x-2 text-blue-800"><i class="fas fa-spinner animate-spin"></i><p>Processing strategic advisory request...</p></div>';
            openMentorModal(mentorResponse.innerHTML);
            
            const systemPrompt = "You are a Chief Strategy Officer and executive coach. Your response must be highly formal, actionable, and focus on immediate next steps. Limit your response to one paragraph.";
            const userQuery = `The user's targeted career trajectory is ${userData.selectedPathway.name}. Their Capstone Project status is ${userData.capstoneStatus}. Based on this context, provide one actionable, highly formal next step or piece of advice related to advancing their career. If the Capstone is NOT CERTIFIED, the advice should focus on completing or submitting it. If it IS CERTIFIED, the advice should focus on leveraging the certification for job placement or networking.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            
            const responseText = await fetchLLMResponse(payload);
            
            if (responseText) {
                 // Check if the pathway has gap skills and include them in the advice if certified
                let gapAdvice = '';
                if (userData.capstoneStatus === 'Certified' && userData.selectedPathway.gapSkills && userData.selectedPathway.gapSkills.length > 0) {
                     gapAdvice = ` Focus immediately on developing competencies in: ${userData.selectedPathway.gapSkills.join(' and ')} to maximize placement velocity.`;
                }

                mentorResponse.innerHTML = `
                    <p class="text-2xl font-bold primary-color mb-4">Strategic Advisory Counsel</p>
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-gray-700 leading-relaxed">${responseText}${gapAdvice}</p>
                    </div>
                `;
            } else {
                 mentorResponse.innerHTML = '<p class="text-red-600">Failed to retrieve advisory counsel. Please try again.</p>';
            }
        };

        // --- UI Rendering & Logic ---

        const updateUI = () => {
            // 1. Welcome Message
            const displayName = userData.fullName && userData.fullName.trim() !== '' ? userData.fullName.trim() : `Client`;
            welcomeMessage.textContent = `Executive Dashboard: ${displayName}`;

            // 2. Skills List
            skillsList.innerHTML = '';
            if (userData.skills.length === 0) {
                skillsList.innerHTML = '<p class="text-gray-500 text-sm italic">Define core competencies to initiate assessment.</p>';
            }
            userData.skills.forEach(skill => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between bg-gray-100 px-3 py-2 rounded-md border border-gray-200';
                li.innerHTML = `
                    <span class="text-sm font-medium text-gray-800">${skill}</span>
                    <button onclick="removeSkill('${skill}')" class="text-gray-600 hover:text-red-700 transition"><i class="fas fa-times text-xs"></i></button>
                `;
                skillsList.appendChild(li);
            });

            // 3. Pathway Matching
            pathwayContainer.innerHTML = '';
             if (pathwayLoading.style.display !== 'flex') { // Only render if not loading
                if (userData.selectedPathway) {
                    const gapSkillsHtml = (userData.selectedPathway.gapSkills && userData.selectedPathway.gapSkills.length > 0) ? 
                        `<p class="text-sm text-red-700 mt-2 font-semibold flex items-center"><i class="fas fa-exclamation-triangle mr-2"></i> Identified Gaps: ${userData.selectedPathway.gapSkills.join(', ')}</p>` : '';
                    
                    pathwayContainer.innerHTML = `
                        <div class="pathway-card bg-white p-5 rounded-lg shadow-sm border">
                            <p class="text-xs font-semibold uppercase primary-color mb-1">STRATEGIC ALIGNMENT (LLM-Verified)</p>
                            <h3 class="text-xl font-bold text-gray-900">${userData.selectedPathway.name}</h3>
                            <p class="text-sm mt-3 text-gray-700 flex items-center">
                                <i class="fas fa-chart-line mr-2 text-green-600"></i>
                                Relevance Score: <span class="font-bold ml-1">${userData.selectedPathway.relevance}%</span>
                            </p>
                            <p class="text-sm text-gray-700 flex items-center">
                                <i class="fas fa-globe-africa mr-2 primary-color"></i>
                                Market Geometry: <span class="font-bold ml-1">${userData.selectedPathway.geometry}</span>
                            </p>
                            ${gapSkillsHtml}
                        </div>
                        <button onclick="findPathway()" class="w-full primary-bg text-white py-3 rounded-lg font-extrabold text-lg primary-hover transition shadow-lg mt-4">
                            <i class="fas fa-search-location mr-2"></i> Re-Run Analysis
                        </button>
                    `;
                } else {
                    pathwayContainer.innerHTML = `
                        <p class="text-center text-gray-500 italic p-6">Define competencies and execute the market alignment analysis.</p>
                        <button onclick="findPathway()" class="w-full bg-green-700 text-white py-3 rounded-lg font-extrabold text-lg hover:bg-green-800 transition shadow-lg mt-4">
                            <i class="fas fa-search-location mr-2"></i> Determine Optimal Pathway
                        </button>
                    `;
                }
            }

            // 4. Capstone Status
            let statusClass, statusText;
            switch (userData.capstoneStatus) {
                case 'Certified':
                    statusClass = 'status-certified';
                    statusText = 'CERTIFIED';
                    break;
                case 'Submitted':
                    statusClass = 'status-submitted';
                    statusText = 'SUBMITTED FOR AUDIT';
                    break;
                case 'In Progress':
                    statusClass = 'status-inprogress';
                    statusText = 'IN PROGRESS';
                    break;
                case 'Not Started':
                default:
                    statusClass = 'status-notstarted';
                    statusText = 'NOT INITIATED';
                    break;
            }
            capstoneStatusBadge.className = `inline-block border font-bold px-3 py-1 rounded-full text-xs ${statusClass}`;
            capstoneStatusBadge.textContent = statusText;

            // 5. Job Matches
            jobMatchesList.innerHTML = '';
            if (userData.jobMatches.length === 0) {
                jobMatchesList.innerHTML = '<p class="text-gray-500 text-sm italic">No high-relevance placements currently matched.</p>';
            }
            userData.jobMatches.forEach(job => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between border-b last:border-b-0 py-4';
                li.innerHTML = `
                    <div>
                        <p class="font-semibold text-gray-800">${job.title}</p>
                        <p class="text-xs text-gray-500 flex items-center mt-1"><i class="fas fa-map-marker-alt mr-1"></i> ${job.location}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-md font-extrabold text-green-700">${job.match}%</span>
                        <p class="text-xs text-gray-500">Relevance</p>
                    </div>
                `;
                jobMatchesList.appendChild(li);
            });
        };
        
        // --- Event Handlers & Data Manipulation ---
        
        window.addSkill = () => {
            const skill = skillInput.value.trim();
            if (skill && !userData.skills.includes(skill)) {
                userData.skills.push(skill);
                skillInput.value = '';
                saveUserData();
            }
        };

        window.removeSkill = (skill) => {
            userData.skills = userData.skills.filter(s => s !== skill);
            saveUserData();
        };

        window.simulateCapstoneUpdate = (status) => {
            if (!['In Progress', 'Submitted', 'Certified'].includes(status)) return;
            userData.capstoneStatus = status;
            saveUserData();
            displayMessage('info', `Professional certification status updated: ${status}`);
        };

        window.logout = () => {
            if (auth) {
                signOut(auth).then(() => {
                    displayMessage('info', 'Session terminated successfully.');
                    location.reload(); 
                }).catch((error) => {
                    console.error("Logout process failed:", error);
                });
            } else {
                location.reload(); 
            }
        };

        // Initialize on load
        window.onload = initFirebase;
    </script>


    <!-- Loading Overlay (Global) -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="flex flex-col items-center bg-white p-8 rounded-xl shadow-2xl border border-gray-200">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 border-t-2"></div>
            <p class="mt-4 text-lg font-medium primary-color">Awaiting System Initialization...</p>
        </div>
    </div>
    
    <!-- Header -->
    <header class="header-bg shadow sticky top-0 z-50">
        <div class="container mx-auto px-4 md:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <!-- Formal Logo Placeholder -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 primary-color" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.864 23.864 0 0112 15c-3.183 0-6.22-.62-9-1.745M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 14a4 4 0 100-8 4 4 0 000 8z" />
                </svg>
                <span class="text-xl font-bold primary-color">GLOBAL TALENT REGISTRY</span>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="openProfileModal()" class="bg-gray-100 primary-color px-4 py-2 rounded-lg font-medium text-sm hover:bg-gray-200 transition shadow-sm border border-gray-300">
                    <i class="fas fa-id-card-alt mr-1"></i> User Account Management
                </button>
                <button onclick="logout()" class="primary-bg text-white px-4 py-2 rounded-lg font-medium text-sm primary-hover transition shadow-md">
                    <i class="fas fa-power-off mr-1"></i> Terminate Session
                </button>
            </div>
        </div>
    </header>

    <!-- Dashboard Main Content -->
    <main class="container mx-auto px-4 md:px-8 py-10">
        <h1 id="welcome-message" class="text-3xl font-extrabold primary-color mb-3">Executive Dashboard: Client</h1>
        <!-- User ID is shown here for firestore security rule compliance -->
        <p id="user-id-display" class="text-sm text-gray-500 mb-8 font-mono"></p> 
        
        <div class="grid lg:grid-cols-3 gap-8">
            
            <!-- 1. COMPETENCY ASSESSMENT & DEVELOPMENT -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6 card">
                <h2 class="text-xl font-bold text-gray-800 mb-5 flex items-center border-b pb-3"><i class="fas fa-cogs primary-color mr-2"></i> Competency & Development Registry</h2>
                
                <!-- Skill Input -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">1. Define Core Competencies</h3>
                    <div class="flex space-x-2">
                        <input id="skill-input" type="text" placeholder="e.g., Financial Modeling, Python" class="flex-grow border border-gray-300 p-3 rounded-lg focus:ring-blue-900 focus:border-blue-900">
                        <button onclick="addSkill()" class="primary-bg text-white px-4 py-3 rounded-lg font-semibold primary-hover transition"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <!-- Skills List -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Registered Competencies</h3>
                    <ul id="skills-list" class="space-y-3 max-h-48 overflow-y-auto pr-2">
                        <!-- Skills rendered here by JS -->
                    </ul>
                </div>
                
                <!-- Capstone Status -->
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Professional Certification Status</h3>
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p class="text-sm font-medium text-gray-600 mb-2">Current Status:</p>
                    <span id="capstone-status-badge" class="status-notstarted">NOT INITIATED</span>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <button onclick="simulateCapstoneUpdate('In Progress')" class="text-xs bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 transition font-medium">Initiate / Update Work</button>
                        <button onclick="simulateCapstoneUpdate('Submitted')" class="text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition font-medium">Submit for Audit</button>
                    </div>
                </div>

            </div>

            <!-- 2. CAREER PATHWAY MATCHING & GEOMETRY -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6 card relative">
                <h2 class="text-xl font-bold text-gray-800 mb-5 flex items-center border-b pb-3"><i class="fas fa-route text-green-600 mr-2"></i> Strategic Market Alignment</h2>
                
                <h3 class="text-lg font-semibold text-gray-700 mb-3">2. Optimal Career Trajectory</h3>
                <div class="space-y-4">
                    <div id="pathway-container" class="min-h-[120px] flex flex-col justify-center">
                        <!-- Pathway card rendered here by JS -->
                        <p class="text-center text-gray-500 italic p-6">Define competencies and execute the market alignment analysis.</p>
                        <button onclick="findPathway()" class="w-full bg-green-700 text-white py-3 rounded-lg font-extrabold text-lg hover:bg-green-800 transition shadow-lg mt-4">
                            <i class="fas fa-search-location mr-2"></i> Determine Optimal Pathway
                        </button>
                    </div>
                    
                    <!-- Pathway Loading Spinner -->
                    <div id="pathway-loading" class="absolute inset-0 bg-white bg-opacity-90 rounded-xl flex flex-col items-center justify-center hidden">
                        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-green-700"></div>
                        <p class="mt-3 text-sm font-medium text-green-700">Running LLM Market Analysis...</p>
                    </div>

                    <p class="text-sm text-gray-600 mt-4 border-t pt-4">
                        <span class="font-bold primary-color">Market Geometry:</span> Matches profile against high-demand sectors within Botswana's key economic hubs for maximum impact.
                    </p>
                </div>
            </div>

            <!-- 3. JOB PLACEMENT & RELEVANCE -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6 card">
                <h2 class="text-xl font-bold text-gray-800 mb-5 flex items-center border-b pb-3"><i class="fas fa-building text-blue-600 mr-2"></i> Verified Placement Opportunities</h2>
                
                <h3 class="text-lg font-semibold text-gray-700 mb-3">3. High-Relevance Matches</h3>
                
                <ul id="job-matches-list" class="divide-y divide-gray-200">
                    <!-- Job matches rendered here by JS -->
                </ul>

                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Advisory Support</h3>
                    <p class="text-sm text-gray-600 mb-3">Engage the platform's AI Mentor for specialized guidance on skill refinement and career queries.</p>
                    <button onclick="engageAIMentor()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition shadow-md">
                        <i class="fas fa-headset mr-2"></i> Engage AI Mentor
                    </button>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-4 mt-12">
        <div class="container mx-auto px-4 md:px-6 text-center text-sm">
            <p>&copy; 2025 Global Talent Registry. Powered by Advanced Market Intelligence.</p>
        </div>
    </footer>
    
    <!-- Profile Modal Structure (Account Management) -->
    <div id="profile-modal-overlay" class="modal-overlay" onclick="if(event.target.id === 'profile-modal-overlay') closeProfileModal()">
        <div class="modal-container">
            <button class="modal-close-button absolute top-4 right-4 text-gray-500 hover:text-gray-900 transition" onclick="closeProfileModal()"><i class="fas fa-times text-2xl"></i></button>
            <h2 class="text-2xl font-bold primary-color mb-8 border-b pb-3">User Account Record Management</h2>
            
            <form id="profile-form" class="space-y-5">
                <!-- Full Name -->
                <div>
                    <label for="profile-full-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="profile-full-name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-900 focus:ring-blue-900" placeholder="Enter your full name" required>
                </div>

                <!-- Email & Location (Grid) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="profile-email" class="block text-sm font-medium text-gray-700">Business Email Address (For Notifications)</label>
                        <input type="email" id="profile-email" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-900 focus:ring-blue-900" placeholder="your.email@corporation.com">
                    </div>
                    <div>
                        <label for="profile-location" class="block text-sm font-medium text-gray-700">Primary Geographic Base</label>
                        <select id="profile-location" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-900 focus:ring-blue-900">
                            <option value="Gaborone">Gaborone</option>
                            <option value="Francistown">Francistown</option>
                            <option value="Selebi-Phikwe">Selebi-Phikwe</option>
                            <option value="Maun">Maun</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <!-- Desired Role -->
                <div>
                    <label for="profile-desired-role" class="block text-sm font-medium text-gray-700">Target Executive Role</label>
                    <input type="text" id="profile-desired-role" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-900 focus:ring-blue-900" placeholder="e.g., Chief Financial Officer, Head of Department">
                </div>

                <!-- Bio -->
                <div>
                    <label for="profile-bio" class="block text-sm font-medium text-gray-700">Professional Summary Draft</label>
                    <textarea id="profile-bio" rows="4" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-900 focus:ring-blue-900" placeholder="A concise summary of your tenure, core strengths, and future objectives."></textarea>
                </div>
                
                <!-- LLM Summary Generator -->
                <div>
                    <label for="summary-output" class="block text-sm font-medium text-gray-700">Generated Professional Summary / Headline</label>
                    <div class="flex space-x-3">
                        <textarea id="summary-output" rows="2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-900 focus:ring-blue-900" placeholder="Click 'Generate' to create a high-impact summary."></textarea>
                        <button type="button" onclick="generateSummary()" class="bg-gray-700 text-white px-5 py-3 rounded-lg font-semibold hover:bg-gray-800 transition shadow-md whitespace-nowrap self-end">
                            Generate Summary âœ¨
                        </button>
                    </div>
                </div>

                <!-- Save Button -->
                <button type="button" onclick="saveProfile()" class="w-full primary-bg text-white py-3 rounded-lg font-semibold primary-hover transition shadow-lg mt-8">
                    <i class="fas fa-save mr-2"></i> Update Record and Synchronize Dashboard
                </button>
            </form>
        </div>
    </div>
    
    <!-- AI Mentor Modal Structure -->
    <div id="mentor-modal-overlay" class="modal-overlay" onclick="if(event.target.id === 'mentor-modal-overlay') closeMentorModal()">
        <div class="modal-container max-w-lg">
            <button class="modal-close-button absolute top-4 right-4 text-gray-500 hover:text-gray-900 transition" onclick="closeMentorModal()"><i class="fas fa-times text-2xl"></i></button>
            <h2 class="text-2xl font-bold primary-color mb-6 flex items-center"><i class="fas fa-headset mr-2 text-blue-600"></i> AI Strategic Mentor</h2>
            
            <div id="mentor-response" class="min-h-[100px] flex items-center justify-center">
                <!-- Response will be rendered here -->
            </div>
            
            <div class="mt-6 text-sm text-gray-500 border-t pt-4">
                <p>This advisory service provides context-aware strategic counsel based on your current pathway and certification status.</p>
            </div>
        </div>
    </div>
</body>
</html>